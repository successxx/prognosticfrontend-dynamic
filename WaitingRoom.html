<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PrognosticAI Waiting Room</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0">

  <!-- Montserrat font -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    /* ---------------- Global & Layout Styles ---------------- */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Montserrat', sans-serif !important;
    }

    body {
      min-height: 100vh;
      overflow-y: auto;
      overflow-x: hidden;
      background: #F6F7FB; /* Slightly off-white background */
    }

    /* Hide the webinar container by default */
    #webinarContainer {
      display: none;
      background: #ffffff;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      margin: 40px auto;
      max-width: 1400px;
    }

    /* Footer or bottom branding */
    .waiting-room-footer {
      text-align: center;
      margin: 40px auto 20px auto;
      font-size: 0.9rem;
      color: #777;
    }

    /* ---------------- WAITING ROOM CONTAINER ---------------- */
    .waiting-room-container {
      display: flex;
      flex-direction: row;
      justify-content: space-between;
      align-items: flex-start;
      gap: 20px;
      max-width: 1400px;
      margin: 40px auto;
      padding: 0 20px;
    }

    /* Left Column (Countdown, Spinner, Bullets) */
    .left-col {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 25px;
      background: #ffffff;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      padding: 25px;
    }

    /* Right Column (Chat) */
    .right-col {
      flex: 1;
      max-width: 480px; /* or whatever width you prefer */
    }

    /* ---------------- Countdown Header Styles ---------------- */
    .awhp2024-header-wrapper {
      font-family: 'Montserrat', sans-serif;
      text-align: center;
      font-size: 32px;
      font-weight: 800;
      margin: 10px auto 20px;
      padding: 10px;
      color: #2E2E2E;
      line-height: 1.2;
    }

    .awhp2024-timer-text {
      color: #0142ac;
      display: inline;
      font-weight: 900;
    }

    /* ---------------- Webinar Title & Loading Spinner Section ---------------- */
    .webinar-loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      background: transparent;
      width: 100%;
      height: auto;
    }

    .webinar-title {
      font-size: 28px;
      font-weight: 800;
      color: #0142ac;
      margin-bottom: 10px;
      text-align: center;
    }

    .divider {
      width: 60%;
      height: 1px;
      background: #ccc;
      margin: 25px auto 15px auto;
    }

    .loading-container {
      text-align: center;
    }

    .loading-text {
      font-size: 20px;
      font-weight: 700;
      color: #0142ac;
      margin-top: 20px;
    }

    .loading-spinner {
      border: 8px solid rgba(228, 232, 241, 0.5); /* Transparent grey */
      border-top: 8px solid #0142ac; /* Brand color */
      border-radius: 50%;
      width: 80px;
      height: 80px;
      animation: spin 1s linear infinite;
      margin: 0 auto;
    }

    @keyframes spin {
      0%   { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .loading-logo {
      margin-top: 20px;
      display: inline-block;
      padding: 8px 16px;
      font-size: 14px;
      font-weight: 700;
      background-color: #0142ac;
      color: white;
      border-radius: 5px;
      text-decoration: none;
    }

    .loading-logo:hover {
      background-color: #022c78;
      transition: background-color 0.3s;
    }

    /* ---------------- "You Will Learn" Section ---------------- */
    .learning-points-title {
      font-size: 18px;
      font-weight: 700;
      color: #2E2E2E;
      margin-bottom: 10px;
    }

    .learning-points-list {
      list-style: disc inside;
      font-size: 16px;
      color: #2E2E2E;
      line-height: 1.5;
      margin-left: 20px;
    }

    /* --------------- Chat Module Styles (Right Column) --------------- */
    .chat-section {
      background: #fff;
      display: flex;
      flex-direction: column;
      height: 750px;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .chat-header {
      padding: 12px 15px;
      background: #0142AC;
      color: white;
      flex: 0 0 auto;
      border-top-left-radius: 12px;
      border-top-right-radius: 12px;
    }

    .header-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .chat-title {
      font-size: 0.85rem;
      font-weight: 600;
      letter-spacing: -0.02em;
    }

    .toggle-container {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-left: auto;
      padding-left: 15px;
      padding-right: 15px;
    }

    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 40px;
      height: 20px;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0; left: 0; right: 0; bottom: 0;
      background-color: rgba(255,255,255,0.2);
      transition: .4s;
      border-radius: 20px;
    }

    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 16px;
      width: 16px;
      left: 2px;
      bottom: 2px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }

    .toggle-switch input:checked + .toggle-slider {
      background-color: #4CAF50;
    }

    .toggle-switch input:checked + .toggle-slider:before {
      transform: translateX(20px);
    }

    .toggle-label {
      color: white;
      font-size: 0.45rem;
    }

    .viewer-count {
      font-size: 0.55rem;
      background: rgba(255,255,255,0.1);
      padding: 4px 10px;
      border-radius: 20px;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .chat-messages {
      flex: 1 1 auto;
      overflow-y: auto;
      padding: 15px;
      background: #f8f9fa;
      min-height: 0;
    }

    .message {
      margin-bottom: 10px;
      line-height: 1.4;
      animation: fadeIn 0.3s ease;
      font-size: 0.85rem;
      padding: 8px 12px;
      border-radius: 6px;
      max-width: 90%;
      text-align: left;
    }

    .message.user {
      background: #f0f2f5;
      margin-left: auto;
      color: #2c3135;
    }

    .message.host {
      background: #e7f0ff;
      color: #0142AC;
      font-weight: 500;
    }

    .message.system {
      background: #fff3cd;
      color: #856404;
      text-align: center;
      max-width: 100%;
      margin: 15px 0;
      font-size: 0.85rem;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(5px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .chat-input {
      padding: 15px;
      background: #fff;
      border-top: 1px solid #eee;
      flex: 0 0 auto;
    }

    .chat-input input {
      width: 100%;
      padding: 12px;
      border: 1px solid #dfe3e8;
      border-radius: 6px;
      font-size: 0.9rem;
      transition: all 0.3s ease;
      color: #2c3135;
    }

    .chat-input input:focus {
      outline: none;
      border-color: #0142AC;
      box-shadow: 0 0 0 2px rgba(1, 66, 172, 0.1);
    }

    .typing-indicator {
      color: #6c757d;
      font-size: 0.85rem;
      margin-top: 8px;
      font-style: italic;
      height: 20px;
      padding-left: 2px;
    }

    .chat-messages::-webkit-scrollbar {
      width: 8px;
    }

    .chat-messages::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 4px;
    }

    .chat-messages::-webkit-scrollbar-thumb {
      background: #c1c1c1;
      border-radius: 4px;
    }

    .chat-messages::-webkit-scrollbar-thumb:hover {
      background: #a8a8a8;
    }
  </style>
</head>
<body>

<!-- WAITING ROOM CONTAINER -->
<div class="waiting-room-container" id="waitingRoomContainer">
  <!-- LEFT COLUMN: Countdown, Spinner, "You Will Learn..." -->
  <div class="left-col">
    <!-- Countdown Header (15-min Intervals) -->
    <div class="awhp2024-header-wrapper" id="awhp2024-header-wrapper">
      Your webinar begins in
      <span class="awhp2024-timer-text" id="awhp2024-countdown-text">calculating...</span>
    </div>

    <!-- Webinar Title & Spinner -->
    <div class="webinar-loading">
      <div class="webinar-title">PrognosticAI Advanced Training</div>
      <div class="loading-container">
        <div class="loading-spinner"></div>
        <p class="loading-text">
          We are preparing the webinar... grab a notepad and pen while you wait!
        </p>
        <a href="https://prognostic.ai" class="loading-logo" target="_blank">
          Powered by PrognosticAI
        </a>
      </div>
    </div>

    <div class="divider"></div>

    <!-- "You Will Learn..." Section -->
    <div>
      <h3 class="learning-points-title">You will learn...</h3>
      <ul class="learning-points-list">
        <li>How to supercharge your lead funnels with AI</li>
        <li>The secrets to personalized marketing at scale</li>
        <li>Actionable tips to increase conversions immediately</li>
      </ul>
    </div>
  </div>

  <!-- RIGHT COLUMN: Chat -->
  <div class="right-col">
    <!-- (Exactly your original chat code, unchanged) -->
    <div class="chat-section">
      <div class="chat-header">
        <div class="header-top">
          <span class="chat-title">Live Chat</span>
          <div class="toggle-container">
            <label class="toggle-switch">
              <input type="checkbox" id="participantToggle">
              <span class="toggle-slider"></span>
            </label>
            <span class="toggle-label">Show Others</span>
          </div>
          <span class="viewer-count">
            <i>👥</i>
            <span id="viewerCount">41 waiting</span>
          </span>
        </div>
      </div>
      <div class="chat-messages" id="chatMessages"></div>
      <div class="chat-input">
        <input type="text" placeholder="Type your message here..." id="messageInput">
        <div class="typing-indicator" id="typingIndicator"></div>
      </div>
    </div>
  </div>
</div>

<!-- HIDDEN WEBINAR CONTAINER (Shown after countdown hits 0) -->
<div id="webinarContainer">
  <h2 style="color:#0142ac; font-weight:800; margin-bottom:1rem;">
    Webinar is starting now!
  </h2>
  <p style="font-size:1rem; line-height:1.5;">
    <em>(Replace this placeholder with your actual webinar video/player code. 
    Or embed the new webinar chat if needed.)</em>
  </p>
</div>

<!-- Footer at the bottom -->
<div class="waiting-room-footer">
  © 2025 PrognosticAI
</div>

<!-- ---------------- SCRIPTS BELOW ---------------- -->
<script>
/* -------------- 15-minute Interval Countdown WITHOUT redirect --------------- */
(function awhp2024CountdownInit() {
  const AWHP2024 = {
    getNextQuarterHour: function() {
      const now = new Date();
      // Next quarter hour => rounding up time to next 15-min interval
      return new Date(Math.ceil(now.getTime() / (15 * 60 * 1000)) * (15 * 60 * 1000));
    },

    formatTimeLeft: function(ms) {
      const minutes = Math.floor((ms % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((ms % (1000 * 60)) / 1000);

      if (minutes > 0) {
        return `${minutes} minute${minutes !== 1 ? 's' : ''} and ${seconds} second${seconds !== 1 ? 's' : ''}`;
      } else {
        return `${seconds} second${seconds !== 1 ? 's' : ''}`;
      }
    },

    /* Instead of redirect, show the webinar container */
    showWebinar: function() {
      const waitingRoom = document.getElementById('waitingRoomContainer');
      const webinarDiv = document.getElementById('webinarContainer');
      if (waitingRoom && webinarDiv) {
        waitingRoom.style.display = 'none';
        webinarDiv.style.display = 'block';
      }
    },

    updateCountdown: function() {
      const countdownElement = document.getElementById('awhp2024-countdown-text');
      if (!countdownElement) {
        console.error('AWHP2024: Countdown element not found');
        return;
      }
      const now = new Date();
      const nextTime = this.getNextQuarterHour();
      const timeLeft = nextTime - now;

      if (timeLeft <= 0) {
        this.showWebinar();
      } else {
        countdownElement.textContent = this.formatTimeLeft(timeLeft);
      }
    }
  };

  function initializeCountdown() {
    if (document.getElementById('awhp2024-countdown-text')) {
      AWHP2024.updateCountdown();
      setInterval(() => AWHP2024.updateCountdown(), 1000);
    } else {
      console.error('AWHP2024: Required elements not found on page load');
    }
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initializeCountdown);
  } else {
    initializeCountdown();
  }
})();
</script>

<script>
/* -------------- Chat WebSocket + Preloaded Messages --------------- */
const socket = new WebSocket('wss://my-webinar-chat-af28ab3bc4ef.herokuapp.com');

// Class for handling chat messages
class ChatMessage {
  constructor(text, type, user, isAutoGenerated = true) {
    this.text = text;
    this.type = type;
    this.user = user;
    this.isAutoGenerated = isAutoGenerated;
  }
}

const names = [
  "Emma", "Liam", "Olivia", "Noah", "Ava", "Ethan", "Sophia", "Mason",
  "Isabella", "William", "Mia", "James", "Charlotte", "Benjamin", "Amelia",
  "Lucas", "Harper", "Henry", "Evelyn", "Alexander"
];

// Mixed array of basic and more advanced marketing lines
let attendeeMessages = [
  "Cant wait for this to start!",
  "First time here... excited!!",
  "Anyone else waiting?",
  "Advanced question: Has anyone integrated this with Zapier for complex funnels?",
  "Setting up multi-step retargeting is my priority right now",
  "I'm interested in the analytics side of things",
  "Hello everyone from the waiting room!",
  "What about affiliate tracking with UTMs and multi-touch attribution?",
  "Hoping to see a funnel breakdown today",
  "So ready for advanced marketing hacks",
  "Just wanted to see if we can import data from our CRM?",
  "We focus heavily on remarketing campaigns, so I'm curious about that",
  "Looking forward to the Q&A on conversion funnels",
  "We use advanced tracking pixels, does your platform handle that?",
  "Hope we get some real actionable tips here",
  "Is the audio working for everyone?",
  "Anyone else from the marketing dept?",
  "We want to build a segmentation funnel, any best practices?",
  "Cant wait to compare notes after the webinar!",
  "Hello from the social media team!"
];

// Timed pre-loaded messages
const preloadedQuestions = [
  { time: 30, text: "hey everyone! excited for this", user: "Emma" },
  { time: 45, text: "same here! first time in one of these", user: "Michael" },
  { time: 60, text: "do we need to have our cameras on?", user: "Sarah" },
  { time: 90, text: "dont think so, pretty sure its just a webinar", user: "James" },
  { time: 120, text: "what time does this start exactly?", user: "David" },
  { time: 150, text: "should be in about 15 mins i think", user: "Rachel" },
  { time: 180, text: "perfect timing to grab a coffee then!", user: "Thomas" },
  { time: 210, text: "anyone else having audio issues? cant hear anything", user: "Lisa" },
  { time: 240, text: "i think it hasnt started yet thats why", user: "Alex" },
  { time: 270, text: "oh that makes sense lol", user: "Lisa" },
  { time: 300, text: "anyone here used their product before?", user: "Jennifer" },
  { time: 330, text: "not yet but heard good things", user: "Daniel" },
  { time: 360, text: "same, my colleague recommended it", user: "Sophie" },
  { time: 390, text: "will there be a replay available?", user: "Ryan" },
  { time: 420, text: "usually is for these types of webinars", user: "Maria" },
  { time: 450, text: "anyone taking notes? im ready with my notebook", user: "William" },
  { time: 480, text: "got my notepad open too!", user: "Emma" },
  { time: 510, text: "hope theres a q&a section at the end", user: "Noah" },
  { time: 540, text: "same, got lots of questions prepared", user: "Olivia" },
  { time: 570, text: "anyone else from marketing dept here?", user: "Liam" },
  { time: 600, text: "yep! social media manager here", user: "Ava" },
  { time: 630, text: "content marketing team checking in", user: "Ethan" },
  { time: 660, text: "excited to see the analytics features", user: "Sophia" },
  { time: 690, text: "hope they show the dashboard demo", user: "Mason" },
  { time: 720, text: "getting some coffee, brb!", user: "Isabella" },
  { time: 750, text: "good idea, might do the same", user: "Benjamin" },
  { time: 780, text: "anyone know how long the webinar is?", user: "Charlotte" },
  { time: 810, text: "think its an hour with q&a after", user: "Henry" },
  { time: 840, text: "perfect length imo", user: "Amelia" },
  { time: 870, text: "cant wait to see whats new", user: "Lucas" },
  { time: 900, text: "almost time to start!", user: "Harper" }
];

document.addEventListener('DOMContentLoaded', function() {
  const chatMessages = document.getElementById('chatMessages');
  const messageInput = document.getElementById('messageInput');
  const typingIndicator = document.getElementById('typingIndicator');
  let isUserScrolling = false;

  function isNearBottom() {
    const threshold = 50;
    return (chatMessages.scrollHeight - chatMessages.clientHeight - chatMessages.scrollTop) <= threshold;
  }

  function scrollToBottom() {
    chatMessages.scrollTop = chatMessages.scrollHeight;
  }

  chatMessages.addEventListener('scroll', function() {
    isUserScrolling = !isNearBottom();
  });

  // Add message to chat
  function addMessage(text, type, user = '', isAutoGenerated = true) {
    const messageDiv = document.createElement('div');
    messageDiv.className = `message ${type}`;
    messageDiv.textContent = user ? `${user}: ${text}` : text;

    // If it's a real (non-auto) host message, briefly show "typing..."
    if (type === 'host' && !isAutoGenerated) {
      typingIndicator.textContent = 'Selina is typing...';
      setTimeout(() => {
        typingIndicator.textContent = '';
      }, 2000);
    }

    // Tag user messages from others so they can be hidden if toggle is off
    if (type === 'user' && user !== 'You') {
      messageDiv.dataset.participant = 'true';
      messageDiv.dataset.autoGenerated = 'true';
      // The toggle only affects display
      messageDiv.style.display = document.getElementById('participantToggle').checked ? 'block' : 'none';
    }

    chatMessages.appendChild(messageDiv);

    if (!isUserScrolling || user === 'You') {
      scrollToBottom();
    }
  }

  // Toggle "Show Others" on/off
  document.getElementById('participantToggle').addEventListener('change', function(e) {
    const participantMessages = document.querySelectorAll('[data-participant="true"]');
    participantMessages.forEach(msg => {
      msg.style.display = e.target.checked ? 'block' : 'none';
    });
    if (e.target.checked && !isUserScrolling) {
      scrollToBottom();
    }
  });

  // WebSocket connection
  socket.onopen = () => {
    console.log('Connected to chat server');
    scrollToBottom();
  };

  socket.onmessage = (event) => {
    const data = JSON.parse(event.data);
    if (data.type === 'message') {
      addMessage(data.text, data.messageType, data.user, true);
    }
  };

  socket.onerror = (error) => {
    console.error('WebSocket error:', error);
  };

  // Schedule random attendee messages
  function scheduleLocationMessages() {
    const numMessages = Math.min(attendeeMessages.length, Math.floor(Math.random() * 6) + 15);
    let available = [...attendeeMessages];
    let delay = 500;

    for (let i = 0; i < numMessages; i++) {
      const index = Math.floor(Math.random() * available.length);
      const message = available[index];
      available.splice(index, 1);

      const name = names[Math.floor(Math.random() * names.length)];

      setTimeout(() => {
        addMessage(message, 'user', name, true);
      }, delay);

      delay += Math.random() * 1000 + 500;
    }
  }

  // Pre-loaded timed messages
  preloadedQuestions.forEach(question => {
    setTimeout(() => {
      addMessage(question.text, 'user', question.user, true);
    }, question.time * 1000);
  });

  // AI/Host response logic – only runs for real user typed messages
  async function handleHostResponse(userMessage, isAutomated = false) {
    if (isAutomated) return;
    try {
      const randomDelay = Math.random() * 2000;
      await new Promise(resolve => setTimeout(resolve, randomDelay));

      typingIndicator.textContent = 'Selina is typing...';

      const response = await fetch('https://my-webinar-chat-af28ab3bc4ef.herokuapp.com/api/message', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          message: userMessage,
          type: 'user'
        })
      });

      if (!response.ok) {
        throw new Error('API call failed');
      }

      const data = await response.json();
      typingIndicator.textContent = '';

      if (data.response) {
        addMessage(data.response, 'host', 'Kyle', false);
      }
    } catch (error) {
      console.error('Error:', error);
      typingIndicator.textContent = '';
      addMessage('Apologies, I\'m having trouble connecting. Please try again!', 'host', 'Selina', false);
    }
  }

  // Randomly adjust viewer count
  function initializeViewerCount() {
    let currentViewers = 41;
    setInterval(() => {
      const change = Math.random() < 0.5 ? -1 : 1;
      currentViewers = Math.max(40, Math.min(50, currentViewers + change));
      document.getElementById('viewerCount').textContent = `${currentViewers} waiting`;
    }, 5000);
  }

  // Initial host message
  setTimeout(() => {
    addMessage("we'll get started here in just one minute", 'host', 'Selina', true);
    scheduleLocationMessages();
    scrollToBottom();
  }, 4000);

  initializeViewerCount();

  // Real user typing => triggers AI
  messageInput.addEventListener('keypress', async (e) => {
    if (e.key === 'Enter' && messageInput.value.trim()) {
      const userMessage = messageInput.value.trim();
      messageInput.value = '';

      addMessage(userMessage, 'user', 'You', false);
      await handleHostResponse(userMessage, false);
    }
  });
});
</script>
</body>
</html>
